// This file contains functions which utilize the on-board ADC
// DMA was covered briefly in ECE 271+471, this link was referenced for help in setup
// https://embeddedthere.com/stm32-adc-tutorial-using-dma-with-hal-code-example/
#include "main.h"

// Function prototypes
int user_input(int input_adc);
void HAL_ADC_ConvCpltCallback(ADC_HandleTypeDef* hadc);

volatile uint32_t adc_output[2]; // Global buffer to store DMA results
int DMA_flag; // Global flag set to 1 when DMA conversion is complete

// This function takes an input from the potentiometer connected to ADC1_CH1 (PC0)
int user_input(int input_adc){
	input_adc = input_adc * 0.01;
	return input_adc;
}

// Callback function to set DMA "complete" flag
void HAL_ADC_ConvCpltCallback(ADC_HandleTypeDef* hadc){
    if (hadc->Instance == ADC1) { // Confirm ADC1 is the trigger
    	DMA_flag = 1;
    }
}
